/*******************************************************************************************
*  This class is autogenerated from the class ConsoleLogger
*  Do not directly update this class as changes will be lost on rebuild.
*******************************************************************************************/
using System;
using ConsoleApplication1.Loggers;
using Microsoft.ApplicationInsights;
using Microsoft.ApplicationInsights.DataContracts;
using Microsoft.ApplicationInsights.Extensibility;
using CodeEffect.Diagnostics.EventSourceGenerator.AI;


namespace ConsoleApplication1.Diagnostics
{
	internal sealed class ConsoleLogger : IConsoleLogger
	{
		private readonly Microsoft.ServiceFabric.Actors.ActorId _actorId;
		private readonly int _processId;
		private readonly string _machineName;
		// Hello from extension
		private readonly Microsoft.ApplicationInsights.TelemetryClient _telemetryClient;

		public ConsoleLogger(
			Microsoft.ServiceFabric.Actors.ActorId actorId,
			int processId,
			string machineName)
		{
			_actorId = actorId;
			_processId = processId;
			_machineName = machineName;
			// Do stuff in the constructor
			
            _telemetryClient = new Microsoft.ApplicationInsights.TelemetryClient();
            _telemetryClient.Context.User.Id = Environment.UserName;
            _telemetryClient.Context.Session.Id = Guid.NewGuid().ToString();
            _telemetryClient.Context.Device.OperatingSystem = Environment.OSVersion.ToString();

		}

		public void SayHello(
			string message)
		{
			Sample.Current.SayHello(
				_actorId, 
				_processId, 
				_machineName, 
				message
			);

			System.Diagnostics.Debug.WriteLine($"[Console] ERR: SayHello");
           
			System.Diagnostics.Debug.WriteLine($"\t_actorId.ToString():\t{_actorId.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_actorId.Kind.ToString():\t{_actorId.Kind.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_processId:\t{_processId}");
			System.Diagnostics.Debug.WriteLine($"\tEnvironment.MachineName:\t{Environment.MachineName}");
			System.Diagnostics.Debug.WriteLine($"\tmessage:\t{message}");
			_telemetryClient.TrackEvent(
	            nameof(SayHello),
	            new System.Collections.Generic.Dictionary<string, string>()
	            {
	                {"ActorId", _actorId.ToString()},
                    {"ActorIdType", _actorId.Kind.ToString()},
                    {"ProcessId", _processId.ToString()},
                    {"MachineName", Environment.MachineName},
                    {"Message", message}
	            });
    
		}




		public void Message(
			string message)
		{
			Sample.Current.Message(
				_actorId, 
				_processId, 
				_machineName, 
				message
			);

			System.Diagnostics.Debug.WriteLine($"[Console] ERR: Message");
           
			System.Diagnostics.Debug.WriteLine($"\t_actorId.ToString():\t{_actorId.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_actorId.Kind.ToString():\t{_actorId.Kind.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_processId:\t{_processId}");
			System.Diagnostics.Debug.WriteLine($"\tEnvironment.MachineName:\t{Environment.MachineName}");
			System.Diagnostics.Debug.WriteLine($"\tmessage:\t{message}");
			_telemetryClient.TrackEvent(
	            nameof(Message),
	            new System.Collections.Generic.Dictionary<string, string>()
	            {
	                {"ActorId", _actorId.ToString()},
                    {"ActorIdType", _actorId.Kind.ToString()},
                    {"ProcessId", _processId.ToString()},
                    {"MachineName", Environment.MachineName},
                    {"Message", message}
	            });
    
		}




		public void Error(
			System.Exception exception)
		{
			Sample.Current.Error(
				_actorId, 
				_processId, 
				_machineName, 
				exception
			);

			System.Diagnostics.Debug.WriteLine($"[Console, Error] ERR: Error");
           
			System.Diagnostics.Debug.WriteLine($"\t_actorId.ToString():\t{_actorId.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_actorId.Kind.ToString():\t{_actorId.Kind.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_processId:\t{_processId}");
			System.Diagnostics.Debug.WriteLine($"\tEnvironment.MachineName:\t{Environment.MachineName}");
			System.Diagnostics.Debug.WriteLine($"\texception.Message:\t{exception.Message}");
			System.Diagnostics.Debug.WriteLine($"\texception.Source:\t{exception.Source}");
			System.Diagnostics.Debug.WriteLine($"\texception.GetType().FullName:\t{exception.GetType().FullName}");
			System.Diagnostics.Debug.WriteLine($"\texception.AsJson():\t{exception.AsJson()}");
			_telemetryClient.TrackException(
	            exception,
	            new System.Collections.Generic.Dictionary<string, string>()
	            {
                    { "Name", "Error" },
	                {"ActorId", _actorId.ToString()},
                    {"ActorIdType", _actorId.Kind.ToString()},
                    {"ProcessId", _processId.ToString()},
                    {"MachineName", Environment.MachineName},
                    {"Message", exception.Message},
                    {"Source", exception.Source},
                    {"ExceptionTypeName", exception.GetType().FullName},
                    {"Exception", exception.AsJson()}
	            });
    
		}




		public void SayGoodbye(
			string goodbye,
			System.DateTime nightTime)
		{
			Sample.Current.SayGoodbye(
				_actorId, 
				_processId, 
				_machineName, 
				goodbye, 
				nightTime
			);

			System.Diagnostics.Debug.WriteLine($"[Console] ERR: SayGoodbye");
           
			System.Diagnostics.Debug.WriteLine($"\t_actorId.ToString():\t{_actorId.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_actorId.Kind.ToString():\t{_actorId.Kind.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_processId:\t{_processId}");
			System.Diagnostics.Debug.WriteLine($"\tEnvironment.MachineName:\t{Environment.MachineName}");
			System.Diagnostics.Debug.WriteLine($"\tgoodbye:\t{goodbye}");
			System.Diagnostics.Debug.WriteLine($"\tnightTime.ToString():\t{nightTime.ToString()}");
			_telemetryClient.TrackEvent(
	            nameof(SayGoodbye),
	            new System.Collections.Generic.Dictionary<string, string>()
	            {
	                {"ActorId", _actorId.ToString()},
                    {"ActorIdType", _actorId.Kind.ToString()},
                    {"ProcessId", _processId.ToString()},
                    {"MachineName", Environment.MachineName},
                    {"Goodbye", goodbye},
                    {"NightTime", nightTime.ToString()}
	            });
    
		}




		public void Specially(
			ConsoleApplication1.Loggers.Special special)
		{
			Sample.Current.Specially(
				_actorId, 
				_processId, 
				_machineName, 
				special
			);

			System.Diagnostics.Debug.WriteLine($"[Console] ERR: Specially");
           
			System.Diagnostics.Debug.WriteLine($"\t_actorId.ToString():\t{_actorId.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_actorId.Kind.ToString():\t{_actorId.Kind.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_processId:\t{_processId}");
			System.Diagnostics.Debug.WriteLine($"\tEnvironment.MachineName:\t{Environment.MachineName}");
			System.Diagnostics.Debug.WriteLine($"\tspecial.ToString():\t{special.ToString()}");
			_telemetryClient.TrackEvent(
	            nameof(Specially),
	            new System.Collections.Generic.Dictionary<string, string>()
	            {
	                {"ActorId", _actorId.ToString()},
                    {"ActorIdType", _actorId.Kind.ToString()},
                    {"ProcessId", _processId.ToString()},
                    {"MachineName", Environment.MachineName},
                    {"Special", special.ToString()}
	            });
    
		}




		public void StartHello(
			)
		{
			Sample.Current.StartHello(
				_actorId, 
				_processId, 
				_machineName
			);

			System.Diagnostics.Debug.WriteLine($"[Console] ERR: StartHello");
           
			System.Diagnostics.Debug.WriteLine($"\t_actorId.ToString():\t{_actorId.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_actorId.Kind.ToString():\t{_actorId.Kind.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_processId:\t{_processId}");
			System.Diagnostics.Debug.WriteLine($"\tEnvironment.MachineName:\t{Environment.MachineName}");
			_helloStopwatch.Restart();
            var helloOperationHolder = _telemetryClient.StartOperation<RequestTelemetry>("hello");
	       helloOperationHolder.Telemetry.Properties.Add("ActorId", _actorId.ToString());
			helloOperationHolder.Telemetry.Properties.Add("ActorIdType", _actorId.Kind.ToString());
			helloOperationHolder.Telemetry.Properties.Add("ProcessId", _processId.ToString());
			helloOperationHolder.Telemetry.Properties.Add("MachineName", Environment.MachineName);
	       OperationHolder.StartOperation(helloOperationHolder);
    
		}

		private System.Diagnostics.Stopwatch _helloStopwatch = new System.Diagnostics.Stopwatch();



		public void StopHello(
			)
		{
			Sample.Current.StopHello(
				_actorId, 
				_processId, 
				_machineName
			);

			System.Diagnostics.Debug.WriteLine($"[Console] ERR: StopHello");
           
			System.Diagnostics.Debug.WriteLine($"\t_actorId.ToString():\t{_actorId.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_actorId.Kind.ToString():\t{_actorId.Kind.ToString()}");
			System.Diagnostics.Debug.WriteLine($"\t_processId:\t{_processId}");
			System.Diagnostics.Debug.WriteLine($"\tEnvironment.MachineName:\t{Environment.MachineName}");
			_helloStopwatch.Stop();
	        var helloOperationHolder = OperationHolder.StopOperation();
	        _telemetryClient.StopOperation(helloOperationHolder);
	        helloOperationHolder.Dispose();
    
		}




	}
}
